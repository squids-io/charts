apiVersion: v1
kind: ConfigMap
metadata:
  name: squids-user
  namespace: {{.Release.Namespace}}
data:
  application-prod.yml: |
    server:
      port: {{ .Values.service.port }}

    spring:
      datasource:
        url: jdbc:mysql://squids-web-mysql-primary-headless:3306/userdb?useUnicode=true&allowMultiQueries=true&characterEncoding=utf-8&serverTimezone=UTC
        username: {{ .Values.mysql.username }}
        password: {{ .Values.mysql.password }}
      redis:
        host: squids-redis-headless # Redis服务器地址
        database: 0 # Redis数据库索引（默认为0）
        port: 6379 # Redis服务器连接端口
        password: # Redis服务器连接密码（默认为空）
        timeout: 300ms # 连接超时时间（毫秒）

      security:
        oauth2:
          client:
            registration:
              github:
                client-id: {{ .Values.oauth2.github.id }}
                client-secret: {{ .Values.oauth2.github.secret }}
              google:
                client-id: {{ .Values.oauth2.google.id }}
                client-secret: {{ .Values.oauth2.google.secret }}
              wechat:
                client-id: {{ .Values.oauth2.wechat.id }}
                client-secret: {{ .Values.oauth2.wechat.id }}
                authorization-grant-type: authorization_code
                redirect-uri: '{baseUrl}/{action}/oauth2/code/{registrationId}'
                scope: snsapi_login
              alipay:
                client-id: {{ .Values.oauth2.alipay.id }}
                client-secret: {{ .Values.oauth2.alipay.id }}
                authorization-grant-type: authorization_code
                redirect-uri: '{baseUrl}/{action}/oauth2/code/{registrationId}'
                scope: auth_user
          provider:
            wechat:
              authorization-uri: https://open.weixin.qq.com/connect/qrconnect
              token-uri: https://api.weixin.qq.com/sns/oauth2/access_token
              user-info-uri: https://api.weixin.qq.com/sns/userinfo
              user-name-attribute: openid
            alipay:
              authorizationUri: https://openauth.alipay.com/oauth2/publicAppAuthorize.htm
              tokenUri: https://openapi.alipay.com/gateway.do
              user-info-uri: https://openapi.alipay.com/gateway.do
              user-name-attribute: user_id

    mail-squids:
      mailbox: {{ .Values.mail.mailbox }}
      host: {{ .Values.mail.host }}
      password: {{ .Values.mail.password }}

      {{ if eq .Values.env "pro" }}
      reseturl: https://squids.cn/reset_password/
      activeurl: https://squids.cn/api/v1/sso/active/
      {{ end }}

      {{ if ne .Values.env "pro" }}
      reseturl: http://{{.Values.server.host}}/reset_password/
      activeurl: http://{{.Values.server.host}}/api/v1/sso/active/
      {{ end }}

    user-config:
      #邀请用户奖励的佣金 转化成美元需 /1000
      reward_amount: 5000
      #注册地址
      {{ if eq .Values.env "pro" }}
      register_url: https://squids.cn/login?action=join
      cookie-domain: squids.cn
      {{ end }}
      {{ if ne .Values.env "pro" }}
      register_url: http://{{.Values.server.host}}/login?action=join
      cookie-domain: {{.Values.server.host}}
      {{ end }}